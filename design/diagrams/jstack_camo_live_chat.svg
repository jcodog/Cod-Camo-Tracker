<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: jstack_camo_live_chat Pages: 1 -->
<svg width="412pt" height="498pt"
 viewBox="0.00 0.00 412.00 498.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 494)">
<title>jstack_camo_live_chat</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-494 408,-494 408,4 -4,4"/>
<!-- user_start -->
<g id="node1" class="node">
<title>user_start</title>
<path fill="lightgrey" stroke="black" d="M236.5,-490C236.5,-490 165.5,-490 165.5,-490 159.5,-490 153.5,-484 153.5,-478 153.5,-478 153.5,-464 153.5,-464 153.5,-458 159.5,-452 165.5,-452 165.5,-452 236.5,-452 236.5,-452 242.5,-452 248.5,-458 248.5,-464 248.5,-464 248.5,-478 248.5,-478 248.5,-484 242.5,-490 236.5,-490"/>
<text text-anchor="middle" x="201" y="-474.8" font-family="Times,serif" font-size="14.00">User clicks</text>
<text text-anchor="middle" x="201" y="-459.8" font-family="Times,serif" font-size="14.00">Live chat</text>
</g>
<!-- rpc_session -->
<g id="node2" class="node">
<title>rpc_session</title>
<path fill="lightgrey" stroke="black" d="M259.5,-415C259.5,-415 142.5,-415 142.5,-415 136.5,-415 130.5,-409 130.5,-403 130.5,-403 130.5,-389 130.5,-389 130.5,-383 136.5,-377 142.5,-377 142.5,-377 259.5,-377 259.5,-377 265.5,-377 271.5,-383 271.5,-389 271.5,-389 271.5,-403 271.5,-403 271.5,-409 265.5,-415 259.5,-415"/>
<text text-anchor="middle" x="201" y="-399.8" font-family="Times,serif" font-size="14.00">RPC</text>
<text text-anchor="middle" x="201" y="-384.8" font-family="Times,serif" font-size="14.00">chat.startSession</text>
</g>
<!-- user_start&#45;&gt;rpc_session -->
<g id="edge1" class="edge">
<title>user_start&#45;&gt;rpc_session</title>
<path fill="none" stroke="black" d="M201,-451.96C201,-443.88 201,-434.18 201,-425.18"/>
<polygon fill="black" stroke="black" points="204.5,-425.09 201,-415.09 197.5,-425.09 204.5,-425.09"/>
</g>
<!-- session_db -->
<g id="node3" class="node">
<title>session_db</title>
<path fill="lightgrey" stroke="black" d="M134,-326C134,-326 12,-326 12,-326 6,-326 0,-320 0,-314 0,-314 0,-302 0,-302 0,-296 6,-290 12,-290 12,-290 134,-290 134,-290 140,-290 146,-296 146,-302 146,-302 146,-314 146,-314 146,-320 140,-326 134,-326"/>
<text text-anchor="middle" x="73" y="-304.3" font-family="Times,serif" font-size="14.00">ChatSession table</text>
</g>
<!-- rpc_session&#45;&gt;session_db -->
<g id="edge2" class="edge">
<title>rpc_session&#45;&gt;session_db</title>
<path fill="none" stroke="black" d="M174.17,-376.97C154.58,-363.81 127.89,-345.88 106.84,-331.73"/>
<polygon fill="black" stroke="black" points="108.74,-328.8 98.49,-326.13 104.84,-334.61 108.74,-328.8"/>
<text text-anchor="middle" x="198" y="-347.8" font-family="Times,serif" font-size="14.00">Create session</text>
</g>
<!-- ws_user -->
<g id="node4" class="node">
<title>ws_user</title>
<path fill="lightgrey" stroke="black" d="M372,-272C372,-272 256,-272 256,-272 250,-272 244,-266 244,-260 244,-260 244,-246 244,-246 244,-240 250,-234 256,-234 256,-234 372,-234 372,-234 378,-234 384,-240 384,-246 384,-246 384,-260 384,-260 384,-266 378,-272 372,-272"/>
<text text-anchor="middle" x="314" y="-256.8" font-family="Times,serif" font-size="14.00">WebSocket client</text>
<text text-anchor="middle" x="314" y="-241.8" font-family="Times,serif" font-size="14.00">User joins room</text>
</g>
<!-- rpc_session&#45;&gt;ws_user -->
<g id="edge3" class="edge">
<title>rpc_session&#45;&gt;ws_user</title>
<path fill="none" stroke="black" d="M233.51,-376.92C241.11,-371.76 248.8,-365.69 255,-359 276.17,-336.15 292.68,-304.35 302.78,-281.74"/>
<polygon fill="black" stroke="black" points="306.08,-282.93 306.84,-272.37 299.66,-280.15 306.08,-282.93"/>
<text text-anchor="middle" x="299.5" y="-347.8" font-family="Times,serif" font-size="14.00">sessionId</text>
</g>
<!-- ws_staff -->
<g id="node5" class="node">
<title>ws_staff</title>
<path fill="lightgrey" stroke="black" d="M162,-216C162,-216 46,-216 46,-216 40,-216 34,-210 34,-204 34,-204 34,-190 34,-190 34,-184 40,-178 46,-178 46,-178 162,-178 162,-178 168,-178 174,-184 174,-190 174,-190 174,-204 174,-204 174,-210 168,-216 162,-216"/>
<text text-anchor="middle" x="104" y="-200.8" font-family="Times,serif" font-size="14.00">WebSocket client</text>
<text text-anchor="middle" x="104" y="-185.8" font-family="Times,serif" font-size="14.00">Staff joins room</text>
</g>
<!-- session_db&#45;&gt;ws_staff -->
<g id="edge10" class="edge">
<title>session_db&#45;&gt;ws_staff</title>
<path fill="none" stroke="black" d="M60.93,-289.97C57.7,-284.49 54.65,-278.22 53,-272 48.67,-255.68 45.23,-249 53,-234 55.1,-229.94 57.9,-226.24 61.1,-222.89"/>
<polygon fill="black" stroke="black" points="63.55,-225.4 68.66,-216.12 58.87,-220.19 63.55,-225.4"/>
<text text-anchor="middle" x="144" y="-249.3" font-family="Times,serif" font-size="14.00">Staff sees active sessions</text>
</g>
<!-- server_ws -->
<g id="node6" class="node">
<title>server_ws</title>
<path fill="lightgrey" stroke="black" d="M325,-127C325,-127 207,-127 207,-127 201,-127 195,-121 195,-115 195,-115 195,-101 195,-101 195,-95 201,-89 207,-89 207,-89 325,-89 325,-89 331,-89 337,-95 337,-101 337,-101 337,-115 337,-115 337,-121 331,-127 325,-127"/>
<text text-anchor="middle" x="266" y="-111.8" font-family="Times,serif" font-size="14.00">Hono WS handler</text>
<text text-anchor="middle" x="266" y="-96.8" font-family="Times,serif" font-size="14.00">via JStack</text>
</g>
<!-- ws_user&#45;&gt;server_ws -->
<g id="edge4" class="edge">
<title>ws_user&#45;&gt;server_ws</title>
<path fill="none" stroke="black" d="M307.92,-233.89C299.74,-209.52 285.11,-165.94 275.48,-137.25"/>
<polygon fill="black" stroke="black" points="278.68,-135.78 272.18,-127.42 272.05,-138.01 278.68,-135.78"/>
<text text-anchor="middle" x="352.5" y="-193.3" font-family="Times,serif" font-size="14.00">Send message</text>
</g>
<!-- ws_staff&#45;&gt;server_ws -->
<g id="edge8" class="edge">
<title>ws_staff&#45;&gt;server_ws</title>
<path fill="none" stroke="black" d="M137.57,-177.97C162.44,-164.62 196.52,-146.31 223.33,-131.92"/>
<polygon fill="black" stroke="black" points="225.32,-134.82 232.48,-127 222.01,-128.65 225.32,-134.82"/>
<text text-anchor="middle" x="233" y="-148.8" font-family="Times,serif" font-size="14.00">Staff reply</text>
</g>
<!-- redis -->
<g id="node7" class="node">
<title>redis</title>
<path fill="lightgrey" stroke="black" d="M168,-38C168,-38 72,-38 72,-38 66,-38 60,-32 60,-26 60,-26 60,-12 60,-12 60,-6 66,0 72,0 72,0 168,0 168,0 174,0 180,-6 180,-12 180,-12 180,-26 180,-26 180,-32 174,-38 168,-38"/>
<text text-anchor="middle" x="120" y="-22.8" font-family="Times,serif" font-size="14.00">Upstash Redis</text>
<text text-anchor="middle" x="120" y="-7.8" font-family="Times,serif" font-size="14.00">Pub Sub</text>
</g>
<!-- server_ws&#45;&gt;redis -->
<g id="edge6" class="edge">
<title>server_ws&#45;&gt;redis</title>
<path fill="none" stroke="black" d="M226.4,-88.83C215.4,-83.42 203.58,-77.26 193,-71 179.27,-62.88 164.75,-53.02 152.3,-44.14"/>
<polygon fill="black" stroke="black" points="154.21,-41.2 144.05,-38.19 150.11,-46.88 154.21,-41.2"/>
<text text-anchor="middle" x="220" y="-59.8" font-family="Times,serif" font-size="14.00">Publish</text>
</g>
<!-- msg_db -->
<g id="node8" class="node">
<title>msg_db</title>
<path fill="lightgrey" stroke="black" d="M368,-37C368,-37 238,-37 238,-37 232,-37 226,-31 226,-25 226,-25 226,-13 226,-13 226,-7 232,-1 238,-1 238,-1 368,-1 368,-1 374,-1 380,-7 380,-13 380,-13 380,-25 380,-25 380,-31 374,-37 368,-37"/>
<text text-anchor="middle" x="303" y="-15.3" font-family="Times,serif" font-size="14.00">ChatMessage table</text>
</g>
<!-- server_ws&#45;&gt;msg_db -->
<g id="edge5" class="edge">
<title>server_ws&#45;&gt;msg_db</title>
<path fill="none" stroke="black" d="M255.86,-88.81C251.65,-78.74 248.82,-66.23 254,-56 256.24,-51.58 259.3,-47.57 262.81,-43.98"/>
<polygon fill="black" stroke="black" points="265.34,-46.41 270.52,-37.16 260.71,-41.16 265.34,-46.41"/>
<text text-anchor="middle" x="305" y="-59.8" font-family="Times,serif" font-size="14.00">Save message</text>
</g>
<!-- server_ws&#45;&gt;msg_db -->
<g id="edge9" class="edge">
<title>server_ws&#45;&gt;msg_db</title>
<path fill="none" stroke="black" d="M336.59,-88.92C344.21,-84.26 351,-78.39 356,-71 362.85,-60.89 357.18,-51.22 347.4,-43.06"/>
<polygon fill="black" stroke="black" points="349.4,-40.19 339.25,-37.14 345.29,-45.85 349.4,-40.19"/>
</g>
<!-- redis&#45;&gt;ws_staff -->
<g id="edge7" class="edge">
<title>redis&#45;&gt;ws_staff</title>
<path fill="none" stroke="black" d="M118.07,-38.15C116.62,-52.06 114.6,-71.74 113,-89 110.53,-115.68 107.99,-146.12 106.25,-167.7"/>
<polygon fill="black" stroke="black" points="102.75,-167.57 105.43,-177.82 109.72,-168.13 102.75,-167.57"/>
<text text-anchor="middle" x="149.5" y="-104.3" font-family="Times,serif" font-size="14.00">Broadcast</text>
</g>
</g>
</svg>
